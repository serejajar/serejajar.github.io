Отлично! Все выполнено в соответствии с ДЗ. Вам плюсик за то что сделали аутентификацию в вебсокетах:

Обычно студентам приходится доказывать что ее реализация не заканчивается только добавлением переменных window.USER_ID / AUTH_TOKEN на страницу   

Вы правильно используете вебсокеты, есть router. Вообщем, по коду у меня нареканий нет. ДЗ принято.

Рекомендации:
В следующем модуле нужно будет установить ваше приложение на хостинг. Некоторые хостинги (например, Heroku) требует карту и может не работать с российскими картами поэтому советую обратить внимание на другие хостинги, например:

vercel https://vercel.com - он бесплатный, но со всеми проблемами придется разбираться самостоятельно.

рег.ру https://www.reg.ru/vps/linux?rlink=reflink-10929085 - платный хостинг (минимум 0,55р/час), но у них есть поддержка, которая сможет помочь если возникнут затруднения.

---
Рекомендации:

В следующем модуле нужно будет установить ваше приложение на хостинг. Heroku требует карту и может не работать с российскими картами поэтому советую обратить внимание на vercel.

В работе с vercel есть пару нюансов:

- Используя vercel вам нужно будет все пути для экспресса необходимо было прописать через path.

- И скорее всего вам понадобится создать конфиг для vercel в котором нужно будет указать путь к index.js, вот так:
{
  "version": 2,
  "builds": [
    {
      "src": "index.js",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    {
      "src": "/(.*)",
      "dest": "index.js"
    }
  ]
}

---
Я обычно рекомендую вот эту статью дополнительно к изучению, но я думаю вы и так про нее знаете   

https://learn.javascript.ru/websocket


# вебсокеты не работают, хотя код верный
Все оказалось очень просто   . Вам нужно поменять app на  server чтобы запустились вебсокеты:

server.listen(port, () => {
 console.log(` Listening on http://localhost:${port}`);
});
Так вебсокеты сработают.

# почему отправляется буффер вместо строки?
Судя по всему это происходит из-за отличия в версиях ws, вот так все заработает:

wss.on('connection', (ws) => {
    ws.on('message', (data, isBinary) => {
      const message = isBinary ? data : data.toString();
      console.log('message', message);
      // тут мы перепосылаем message всем подключенным клиентам
      wss.clients.forEach(ws => {
        ws.send(message)
      })
    })
});

https://stackoverflow.com/questions/69485407/why-is-received-websocket-data-coming-out-as-a-buffer

# Cannot read properties of undefined (reading 'cookie')
Судя по всему в видео опечатка, так как правильно req.headers, а не req.header как у вас.

const cookies = cookie.parse(req.headers["cookie"])

Я напишу об этом создателю курса, чтобы они исправили этот момент в видео.

# Как делать вебсокеты с CLI клиентом
1) В switch вам нужно вызвать функцию которая будет создвавать вебсокет и подключаться к серверу

import { socket } from "./fnSocket.js";

(() => {
  switch (process.argv[2]) {
    case "login": {
      socket("login");
      break;
    }
    case "signup": {
      socket("signup");
      break;
    }
    default: {
      console.error(`You need to login first`);
    }
  }
})();


2) В самой функции вы можете залогинится и затем создать вебсокет.

import inquirer from "inquirer";
import fetch from "node-fetch";
import chalk from "chalk";
import { WebSocket } from 'ws';
import { tableRender, authQuestions, commandQuestion, timerQuestion, timerIdQuestion } from "./fnHelpers.js";

let client = null;

export async function socket(param) {
  const loginData = await inquirer.prompt(authQuestions);
  const response = await fetch(`http://localhost:3000/${param}`, {
    method: "POST",
    headers: {
      "Content-type": "application/json",
    },
    body: JSON.stringify({
      username: loginData.username,
      password: loginData.password,
    }),
  })

  const { token, error } = await response.json();

  if (error) {
    console.log(chalk.bold.red(error));
    return;
  } else if (!token) {
    console.log(chalk.bold.red("Access closed"));
    return;
  } else {
    console.log(chalk.bold.green("Access is open"));
  }

  client = new WebSocket(`ws://localhost:3000?token=${token}`);

  client.on("open", () => {
    startCommand();
  });

  client.on("message", (message) => {
    let data;
    try {
      data = JSON.parse(message);
    } catch (err) {
      return;
    }

    switch (data.type) {
      case "timer_list": {
        if (data.timerList && data.timerList.length > 0) {
          tableRender(data.timerList);
        } else {
          console.log(`${chalk.bold.blue("List of timers is empty")}`)
        }
        break;
      }
      case "timer_start": {
        console.log(`${chalk.bold.green(data.message)}`)
        break;
      }
      case "timer_stop": {
        console.log(`${chalk.bold.red(data.message)}`)
        break;
      }
      default: {
        console.error(`Sorry, no such command exists`);
      }
    }

    startCommand();
  })
}


---- Не для письма ---
Работа другого студента:
https://go.skillbox.ru/homeworks/6d5276c8-9574-453f-94d5-cb9b76dc7134
----

###
Прочее

Добавьте в репозиторий код из 7, 8 или 9 модуля и напишите мне чтобы мы приступили к реализации вебсокетов.


Следующим шагом добавьте ws на серверную часть. Установите необходимую библиотеку ws и настройте ее в что бы она работала с express.


Теперь вам нужно добавить код для отправки сообщений с сервера. Вы его можете найти в видео уроках. Не забудьте запушить код в репозиторий, чтобы я смог проверить его.

Теперь попробуйте передать сообщение с сервера и получить его на клиенте. В этом вам поможет видео 11.3 и 11.4.  Если запутаетесь, напишите мне и я помогу вам.
---
main.js:76 WebSocket connection to 'ws://localhost:3000/' failed: Error during WebSocket handshake: Unexpected response code: 200
